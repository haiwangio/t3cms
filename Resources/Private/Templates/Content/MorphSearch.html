<div xmlns="http://www.w3.org/1999/xhtml" lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:flux="http://typo3.org/ns/FluidTYPO3/Flux/ViewHelpers"
      xmlns:se="http://typo3.org/ns/SalvatoreEckel/T3cms/ViewHelpers">

<f:layout name="Content"/>

<f:section name="Configuration">
    <flux:form id="morphSearch" label="MorphSearch" options="{group:'T3cms',Fluidcontent: {sorting:81},icon:'EXT:t3cms/ext_icon.png'}" localLanguageFileRelativePath="/Resources/Private/Language/mocallang_morphSearch.xlf">
        <flux:form.sheet name="generalSheet" label="General" variables="{_all}">
          <flux:field.input name="settings.placeholder"
                            label="Placeholder Text"
                            default="Search..." />
        </flux:form.sheet>
        <flux:form.sheet name="colorSheet" label="Colors" variables="{_all}">
          <flux:field.input name="settings.inputTextColor" label="Input Text color (optional)">
            <flux:wizard.colorPicker label="'Color Picker'" hideParent="1" dim="'128x128'" width="256" height="256" exampleImg="'EXT:flux/Resources/Public/Icons/ColorWheel.png'"></flux:wizard.colorPicker>
          </flux:field.input>
          <flux:field.input name="settings.inputBgColor" label="Input Background Color (optional)">
            <flux:wizard.colorPicker label="'Color Picker'" hideParent="1" dim="'128x128'" width="256" height="256" exampleImg="'EXT:flux/Resources/Public/Icons/ColorWheel.png'"></flux:wizard.colorPicker>
          </flux:field.input>
          <flux:field.input name="settings.overlayBgColor" label="Overlay Background Color (optional)">
            <flux:wizard.colorPicker label="'Color Picker'" hideParent="1" dim="'128x128'" width="256" height="256" exampleImg="'EXT:flux/Resources/Public/Icons/ColorWheel.png'"></flux:wizard.colorPicker>
          </flux:field.input>
        </flux:form.sheet>
    </flux:form>
</f:section>

<f:section name="Preview">
    <small><strong>FCE: Morph Search</strong></small>
    <hr/>
    <div id="morphsearch_{record.uid}" class="morphsearch">
        <form class="morphsearch-form">
            <input class="morphsearch-input" type="search" placeholder="{settings.placeholder}"/>
            <button class="morphsearch-submit" type="submit"></button>
        </form>
        <span class="morphsearch-close"></span>
    </div><!-- /morphsearch -->
    <div class="overlay"></div>
    <f:render section="Css" />
    <f:render section="Js" arguments="{uid:record.uid}" />
</f:section>

<f:section name="Main">
    <div id="morphsearch_{record.uid}" class="morphsearch">
        <form class="morphsearch-form">
            <input class="morphsearch-input" type="search" placeholder="{settings.placeholder}"/>
            <button class="morphsearch-submit" type="submit"></button>
        </form>
        <span class="morphsearch-close"></span>
    </div><!-- /morphsearch -->
    <div class="overlay"></div>
    <f:render section="Css" />
    <f:render section="Js" arguments="{uid:record.uid}" />
</f:section>

<f:section name="Css">
  <f:comment>General style</f:comment>
    <se:includeStyle name="morphSearch" css="body,html{height:100%}body{overflow-x:hidden;overflow-y:scroll}.morphsearch{width:200px;min-height:40px;background:#f1f1f1;position:absolute;z-index:10000;top:50px;right:50px;-webkit-transform-origin:100% 0;transform-origin:100% 0;-webkit-transition-property:min-height, width, top, right;transition-property:min-height, width, top, right;-webkit-transition-duration:0.5s;transition-duration:0.5s;-webkit-transition-timing-function:cubic-bezier(0.7,0,0.3,1);transition-timing-function:cubic-bezier(0.7,0,0.3,1)}.morphsearch.open{width:100%;min-height:100%;top:0;right:0}.morphsearch-form{width:100%;height:40px;margin:0 auto;position:relative;-webkit-transition-property:width, height, -webkit-transform;transition-property:width, height, transform;-webkit-transition-duration:0.5s;transition-duration:0.5s;-webkit-transition-timing-function:cubic-bezier(0.7,0,0.3,1);transition-timing-function:cubic-bezier(0.7,0,0.3,1)}.morphsearch.open .morphsearch-form{width:80%;height:160px;-webkit-transform:translate3d(0,3em,0);transform:translate3d(0,3em,0)}.morphsearch-input{width:100%;height:100%;padding:0 10% 0 10px;font-weight:700;border:none;background:transparent;font-size:0.8em;color:#ec5a62;-webkit-transition:font-size 0.5s cubic-bezier(0.7,0,0.3,1);transition:font-size 0.5s cubic-bezier(0.7,0,0.3,1)}.morphsearch-input::-ms-clear{display:none}.morphsearch.hideInput .morphsearch-input{color:transparent;-webkit-transition:color 0.3s;transition:color 0.3s}.morphsearch.open .morphsearch-input{font-size:7em}.morphsearch-input::-webkit-input-placeholder{color:#c2c2c2}.morphsearch-input:-moz-placeholder{color:#c2c2c2}.morphsearch-input::-moz-placeholder{color:#c2c2c2}.morphsearch-input:-ms-input-placeholder{color:#c2c2c2}.gn-search:focus::-webkit-input-placeholder{color:transparent}input[type='search']{-webkit-box-sizing:border-box;box-sizing:border-box}.morphsearch-input:focus,.morphsearch-submit:focus{outline:none}.morphsearch-submit{position:absolute;width:80px;height:80px;text-indent:100px;overflow:hidden;right:0;top:50%;background:transparent url('../img/magnifier.svg') no-repeat center center;background-size:100%;border:none;pointer-events:none;transform-origin:50% 50%;opacity:0;-webkit-transform:translate3d(-30px,-50%,0) scale3d(0,0,1);transform:translate3d(-30px,-50%,0) scale3d(0,0,1)}" />
</f:section>

<f:section name="Js">
  <script>(function(window){'use strict';function classReg(className){return new RegExp("(^|\\s+)"+className+"(\\s+|$)")}var hasClass,addClass,removeClass;if('classList'in document.documentElement){hasClass=function(elem,c){return elem.classList.contains(c)};addClass=function(elem,c){elem.classList.add(c)};removeClass=function(elem,c){elem.classList.remove(c)}}else{hasClass=function(elem,c){return classReg(c).test(elem.className)};addClass=function(elem,c){if(!hasClass(elem,c)){elem.className=elem.className+' '+c}};removeClass=function(elem,c){elem.className=elem.className.replace(classReg(c),' ')}}function toggleClass(elem,c){var fn=hasClass(elem,c)?removeClass:addClass;fn(elem,c)}var classie={hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,has:hasClass,add:addClass,remove:removeClass,toggle:toggleClass};if(typeof define==='function'&&define.amd){define(classie)}else{window.classie=classie}})(window);</script>
  <script>
    morphsearch('morphsearch_{uid}');
    function morphsearch(id) {
      var morphSearch = document.getElementById( id ),
        input = morphSearch.querySelector( 'input.morphsearch-input' ),
        ctrlClose = morphSearch.querySelector( 'span.morphsearch-close' ),
        isOpen = isAnimating = false,
        // show/hide search area
        toggleSearch = function(evt) {
          // return if open and the input gets focused
          if( evt.type.toLowerCase() === 'focus' && isOpen ) return false;

          if( isOpen ) {
            classie.remove( morphSearch, 'open' );

            // trick to hide input text once the search overlay closes 
            // todo: hardcoded times, should be done after transition ends
            if( input.value !== '' ) {
              setTimeout(function() {
                classie.add( morphSearch, 'hideInput' );
                setTimeout(function() {
                  classie.remove( morphSearch, 'hideInput' );
                  input.value = '';
                }, 300 );
              }, 500);
            }
            
            input.blur();
          }
          else {
            classie.add( morphSearch, 'open' );
          }
          isOpen = !isOpen;
        };

      // events
      input.addEventListener( 'focus', toggleSearch );
      ctrlClose.addEventListener( 'click', toggleSearch );
      // esc key closes search overlay
      // keyboard navigation events
      document.addEventListener( 'keydown', function( ev ) {
        var keyCode = ev.keyCode || ev.which;
        if( keyCode === 27 && isOpen ) {
          toggleSearch(ev);
        }
      } );


      /***** for demo purposes only: don't allow to submit the form *****/
      morphSearch.querySelector( 'button[type="submit"]' ).addEventListener( 'click', function(ev) { ev.preventDefault(); } );
    }
  </script>
</f:section>

</div>